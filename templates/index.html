<!DOCTYPE html>
<html>
<head>
    <title>Game</title>
    <script>
        //Inventory fuctionality

        let inventoryVisible = false;

        function updateInventory() {
            fetch('/inventory')
                .then(response => response.json())
                .then(data => {
                    let output = "<h3>Your Inventory:</h3><ul>";
                    for (const [item, amount] of Object.entries(data)) {
                        output += `<li>${item}: ${amount}</li>`;
                    }
                    output += "</ul>";
                    const inventoryDiv = document.getElementById('inventory');
                    inventoryDiv.innerHTML = output;
                });
        }

        function toggleInventory() {
            const inventoryDiv = document.getElementById('inventory');
            inventoryVisible = !inventoryVisible;

            if (inventoryVisible) {
                inventoryDiv.style.display = 'block';
                updateInventory();
            } else {
                inventoryDiv.style.display = 'none';
            }
        }

        //Crafting Menu functionality

        let craftingVisible = false;

        function toggleCrafting() {
            const craftingDiv = document.getElementById('crafting');
            craftingVisible = !craftingVisible;

            if (craftingVisible) {
                fetch('/crafting')
                    .then(res => res.json())
                    .then(data => {
                        let html = '<h3>Crafting Menu</h3><ul>';
                        data.forEach(item => {
                            let costStr = Object.entries(item.cost)
                                .map(([key, val]) => `${key}: ${val}`)
                                .join(', ');
                            html += `<li>${item.name} (${costStr}) - ${item.available ? '✅ Available' : '❌ Not enough resources'}</li>`;
                        });
                        html += '</ul>';
                        craftingDiv.innerHTML = html;
                        craftingDiv.style.display = 'block';
                    });
            } else {
                craftingDiv.style.display = 'none';
            }
        }


        // Recource Collection functions

        function collectFiber() {
            fetch('/collect_fiber', {
                    method:'POST'
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('output').innerText = data.message;
                    if (inventoryVisible) updateInventory();
                });
        }
        function collectStick() {
            fetch('/collect_stick', {
                    method:'POST'
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('output').innerText = data.message;
                    if (inventoryVisible) updateInventory();
                });
        }
         function collectStone() {
            fetch('/collect_stone', {
                    method:'POST'
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('output').innerText = data.message;
                    if (inventoryVisible) updateInventory();
                });
        }

        // Crafting functions

        function craftRope() {
            fetch('/craft_rope', {
                    method:'POST'
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('output').innerText = data.message;
                    if (inventoryVisible) updateInventory();
                });
        }

        function craftWoodenHandle() {
            fetch('/craft_wooden_handle', {
                    method:'POST'
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('output').innerText = data.message;
                    if (inventoryVisible) updateInventory();
                });
        }





    </script>
</head>
<body>
    <h1>Survival Game</h1>
    <button onclick="collectFiber()">Collect Plant Fiber</button><br><br>
    <button onclick="collectStick()">Collect Sticks</button><br><br>
    <button onclick="collectStone()">Collect Stones</button><br><br>
    <button onclick="craftRope()">Craft Rope (-10 Plant Fiber)</button><br><br>
    <button onclick="craftWoodenHandle()">Craft Wooden Handle (-4 Sticks, -2 Rope)</button><br><br>
    <button onclick="toggleInventory()">Show/Hide Inventory</button>
    <div id="inventory" style="display: none;"></div>
    <button onclick="toggleCrafting()">Toggle Crafting Menu</button>
    <div id="crafting" style="display: none;"></div>
    <p id="output"></p>
</body>
</html>